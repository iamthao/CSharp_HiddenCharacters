æ7
MD:\GithubSvn\GitHub\TestCommitGithub\AddWebsiteToIIS\AddWebToISS\IisHelper.cs
	namespace

 	
AddWebToISS


 
{ 
public 

class 
	IisHelper 
{ 
public 
static 
void 
	AddNewWeb $
($ %
string% +
webSiteName, 7
,7 8
string9 ?

hostDomain@ J
,J K
stringL R
physicalPathS _
,_ `
inta d
porte i
,i j
TimeSpank s
connectionTimeOut	t Ö
,
Ö Ü
bool
á ã
isApiWeb
å î
=
ï ñ
false
ó ú
,
ú ù
bool
û ¢
isSsl
£ ®
=
© ™
false
´ ∞
,
∞ ±
string
≤ ∏

certString
π √
=
ƒ ≈
$str
∆ »
)
» …
{ 	
var 

iisManager 
= 
new  
ServerManager! .
(. /
)/ 0
;0 1
if 
( 
CheckDomainExist  
(  !
webSiteName! ,
), -
)- .
{ 

RemoveHost 
( 
webSiteName &
)& '
;' (
} 
physicalPath 
= 
physicalPath '
.' (
Replace( /
(/ 0
$str0 5
,5 6
$str7 ;
); <
.< =
Replace= D
(D E
$strE J
,J K
$strL P
)P Q
;Q R
var 
sites 
= 

iisManager "
." #
Sites# (
;( )
var 
bindingInformartion #
=$ %
string& ,
., -
Format- 3
(3 4
$str4 ?
,? @
portA E
,E F

hostDomainG Q
)Q R
;R S
var  
bindingInformartion2 $
=% &
string' -
.- .
Format. 4
(4 5
$str5 @
,@ A
portB F
,F G
$strH N
+O P

hostDomainQ [
)[ \
;\ ]
var 
site 
= 
sites 
. 
Add  
(  !
webSiteName! ,
,, -
$str. 4
,4 5
bindingInformartion6 I
,I J
physicalPathK W
)W X
;X Y
site 
. 
Bindings 
. 
Add 
(  
bindingInformartion2 2
,2 3
$str4 :
): ;
;; <
site 
. 
Limits 
. 
ConnectionTimeout )
=* +
connectionTimeOut, =
;= >

iisManager   
.   
ApplicationPools   '
.  ' (
Add  ( +
(  + ,
webSiteName  , 7
)  7 8
;  8 9
if!! 
(!! 
isApiWeb!! 
)!! 
{"" 
foreach## 
(## 
var## 
applicationPool## ,
in##- /

iisManager##0 :
.##: ;
ApplicationPools##; K
)##K L
{$$ 
applicationPool%% #
.%%# $
	AutoStart%%$ -
=%%. /
true%%0 4
;%%4 5
applicationPool&& #
.&&# $
ProcessModel&&$ 0
.&&0 1
IdleTimeout&&1 <
=&&= >
new&&? B
TimeSpan&&C K
(&&K L
$num&&L N
,&&N O
$num&&P Q
,&&Q R
$num&&S T
)&&T U
;&&U V
}'' 
}(( 
site** 
.** 
ApplicationDefaults** $
.**$ %
ApplicationPoolName**% 8
=**9 :
webSiteName**; F
;**F G

iisManager,, 
.,, 
CommitChanges,, $
(,,$ %
),,% &
;,,& '
}-- 	
public// 
static// 
void// 

RemoveHost// %
(//% &
string//& ,
webSiteName//- 8
)//8 9
{00 	
var11 

iisManager11 
=11 
new11  
ServerManager11! .
(11. /
)11/ 0
;110 1
var22 
sites22 
=22 

iisManager22 "
.22" #
Sites22# (
;22( )
var44 
st44 
=44 
sites44 
[44 
webSiteName44 &
]44& '
;44' (
if55 
(55 
st55 
!=55 
null55 
)55 

iisManager55 &
.55& '
Sites55' ,
.55, -
Remove55- 3
(553 4
st554 6
)556 7
;557 8
var77 
pool77 
=77 

iisManager77 !
.77! "
ApplicationPools77" 2
[772 3
webSiteName773 >
]77> ?
;77? @
if88 
(88 
pool88 
!=88 
null88 
)88 

iisManager88 (
.88( )
ApplicationPools88) 9
.889 :
Remove88: @
(88@ A
pool88A E
)88E F
;88F G

iisManager:: 
.:: 
CommitChanges:: $
(::$ %
)::% &
;::& '
};; 	
public== 
static== 
bool== 
CheckDomainExist== +
(==+ ,
string==, 2
webSiteName==3 >
)==> ?
{>> 	
ServerManager?? 
serverManager?? '
=??( )
new??* -
ServerManager??. ;
(??; <
)??< =
;??= >
if@@ 
(@@ 
serverManager@@ 
.@@ 
Sites@@ #
.@@# $
Any@@$ '
(@@' (
o@@( )
=>@@* ,
o@@- .
.@@. /
Name@@/ 3
.@@3 4
ToLower@@4 ;
(@@; <
)@@< =
.@@= >
Equals@@> D
(@@D E
webSiteName@@E P
.@@P Q
ToLower@@Q X
(@@X Y
)@@Y Z
)@@Z [
)@@[ \
)@@\ ]
{AA 
returnBB 
trueBB 
;BB 
}CC 
ifDD 
(DD 
serverManagerDD 
.DD 
ApplicationPoolsDD .
.DD. /
AnyDD/ 2
(DD2 3
oDD3 4
=>DD5 7
oDD8 9
.DD9 :
NameDD: >
.DD> ?
ToLowerDD? F
(DDF G
)DDG H
.DDH I
EqualsDDI O
(DDO P
webSiteNameDDP [
.DD[ \
ToLowerDD\ c
(DDc d
)DDd e
)DDe f
)DDf g
)DDg h
{EE 
returnFF 
trueFF 
;FF 
}GG 
returnHH 
falseHH 
;HH 
}II 	
}JJ 
}KK àS
UD:\GithubSvn\GitHub\TestCommitGithub\AddWebsiteToIIS\AddWebToISS\IIISHostingHelper.cs
	namespace 	
AddWebToISS
 
{ 
public 

	interface 
IIISHostingHelper &
{		 
void

 
AddHost

 
(

 
string

 
webSiteName

 '
,

' (
string

) /

hostDomain

0 :
,

: ;
string

< B
physicalPath

C O
,

O P
int

Q T
port

U Y
,

Y Z
TimeSpan

[ c
connectionTimeOut

d u
,

u v
bool

w {
isApiWeb	

| Ñ
=


Ö Ü
false


á å
,


å ç
bool


é í
isSsl


ì ò
=


ô ö
false


õ †
,


† °
string


¢ ®

certString


© ≥
=


¥ µ
$str


∂ ∏
)


∏ π
;


π ∫
void 

RemoveHost 
( 
string 
webSiteName *
)* +
;+ ,
} 
public 

class 
IISHostingHelper !
:" #
IIISHostingHelper$ 5
{ 
public 
void 
AddHost 
( 
string "
webSiteName# .
,. /
string0 6

hostDomain7 A
,A B
stringC I
physicalPathJ V
,V W
intX [
port\ `
,` a
TimeSpanb j
connectionTimeOutk |
,| }
bool	~ Ç
isApiWeb
É ã
=
å ç
false
é ì
,
ì î
bool
ï ô
isSsl
ö ü
=
† °
false
¢ ß
,
ß ®
string
© Ø

certString
∞ ∫
=
ª º
$str
Ω ø
)
ø ¿
{ 	
var 

iisManager 
= 
new  
ServerManager! .
(. /
)/ 0
;0 1
physicalPath 
= 
physicalPath '
.' (
Replace( /
(/ 0
$str0 5
,5 6
$str7 ;
); <
.< =
Replace= D
(D E
$strE J
,J K
$strL P
)P Q
;Q R
var 
sites 
= 

iisManager "
." #
Sites# (
;( )
var 
bindingInformartion #
=$ %
string& ,
., -
Format- 3
(3 4
$str4 ?
,? @
portA E
,E F

hostDomainG Q
)Q R
;R S
var  
bindingInformartion2 $
=% &
string' -
.- .
Format. 4
(4 5
$str5 @
,@ A
portB F
,F G
$strH N
+O P

hostDomainQ [
)[ \
;\ ]
var 
site 
= 
sites 
. 
Add  
(  !
webSiteName! ,
,, -
$str. 4
,4 5
bindingInformartion6 I
,I J
physicalPathK W
)W X
;X Y
site 
. 
Bindings 
. 
Add 
(  
bindingInformartion2 2
,2 3
$str4 :
): ;
;; <
site 
. 
Limits 
. 
ConnectionTimeout )
=* +
connectionTimeOut, =
;= >
if 
( 
isSsl 
&& 
! 
string  
.  !
IsNullOrEmpty! .
(. /

certString/ 9
)9 :
): ;
{ 
var "
bindingInformartionSsl *
=+ ,
string- 3
.3 4
Format4 :
(: ;
$str; F
,F G
$numH K
,K L

hostDomainM W
)W X
;X Y
var   #
bindingInformartion2Ssl   +
=  , -
string  . 4
.  4 5
Format  5 ;
(  ; <
$str  < G
,  G H
$num  I L
,  L M
$str  N T
+  U V

hostDomain  W a
)  a b
;  b c
var## 
store## 
=## 
new## 
	X509Store##  )
(##) *
	StoreName##* 3
.##3 4
My##4 6
,##6 7
StoreLocation##8 E
.##E F
LocalMachine##F R
)##R S
;##S T
store$$ 
.$$ 
Open$$ 
($$ 
	OpenFlags$$ $
.$$$ %
ReadOnly$$% -
)$$- .
;$$. /
foreach%% 
(%% 
X509Certificate2%% )
mCert%%* /
in%%0 2
store%%3 8
.%%8 9
Certificates%%9 E
)%%E F
{&& 
var(( 
certStr(( 
=((  !

certString((" ,
;((, -
if** 
(** 
mCert** 
.** 

Thumbprint** (
!=**) +
null**, 0
&&**1 3
mCert**4 9
.**9 :

Thumbprint**: D
.**D E
ToUpper**E L
(**L M
)**M N
.**N O
Contains**O W
(**W X
certStr**X _
)**_ `
)**` a
{++ 
var,, 
bindingCollection,, -
=,,. /
site,,0 4
.,,4 5
Bindings,,5 =
;,,= >
var-- 
binding-- #
=--$ %
site--& *
.--* +
Bindings--+ 3
.--3 4
CreateElement--4 A
(--A B
$str--B K
)--K L
;--L M
binding.. 
[..  
$str..  *
]..* +
=.., -
$str... 5
;..5 6
binding// 
[//  
$str//  *
]//* +
=//, -
$num//. /
;/// 0
binding00 
[00  
$str00  1
]001 2
=003 4
mCert005 :
.00: ;
GetCertHashString00; L
(00L M
)00M N
;00N O
binding11 
[11  
$str11  6
]116 7
=118 9
$str11: >
;11> ?
binding22 
[22  
$str22  4
]224 5
=226 7"
bindingInformartionSsl228 N
;22N O
bindingCollection33 )
.33) *
Add33* -
(33- .
binding33. 5
)335 6
;336 7
var66 
binding166 $
=66% &
site66' +
.66+ ,
Bindings66, 4
.664 5
CreateElement665 B
(66B C
$str66C L
)66L M
;66M N
binding177  
[77  !
$str77! +
]77+ ,
=77- .
$str77/ 6
;776 7
binding188  
[88  !
$str88! +
]88+ ,
=88- .
$num88/ 0
;880 1
binding199  
[99  !
$str99! 2
]992 3
=994 5
mCert996 ;
.99; <
GetCertHashString99< M
(99M N
)99N O
;99O P
binding1::  
[::  !
$str::! 7
]::7 8
=::9 :
$str::; ?
;::? @
binding1;;  
[;;  !
$str;;! 5
];;5 6
=;;7 8#
bindingInformartion2Ssl;;9 P
;;;P Q
bindingCollection<< )
.<<) *
Add<<* -
(<<- .
binding1<<. 6
)<<6 7
;<<7 8
break== 
;== 
}>> 
}@@ 
storeBB 
.BB 
CloseBB 
(BB 
)BB 
;BB 
siteFF 
.FF 
LimitsFF 
.FF 
ConnectionTimeoutFF -
=FF. /
connectionTimeOutFF0 A
;FFA B
}GG 

iisManagerII 
.II 
ApplicationPoolsII '
.II' (
AddII( +
(II+ ,
webSiteNameII, 7
)II7 8
;II8 9
ifJJ 
(JJ 
isApiWebJJ 
)JJ 
{KK 
foreachLL 
(LL 
varLL 
applicationPoolLL ,
inLL- /

iisManagerLL0 :
.LL: ;
ApplicationPoolsLL; K
)LLK L
{MM 
applicationPoolNN #
.NN# $
	AutoStartNN$ -
=NN. /
trueNN0 4
;NN4 5
applicationPoolOO #
.OO# $
ProcessModelOO$ 0
.OO0 1
IdleTimeoutOO1 <
=OO= >
newOO? B
TimeSpanOOC K
(OOK L
$numOOL N
,OON O
$numOOP Q
,OOQ R
$numOOS T
)OOT U
;OOU V
}PP 
}QQ 
siteSS 
.SS 
ApplicationDefaultsSS $
.SS$ %
ApplicationPoolNameSS% 8
=SS9 :
webSiteNameSS; F
;SSF G

iisManagerUU 
.UU 
CommitChangesUU $
(UU$ %
)UU% &
;UU& '
}XX 	
publicZZ 
voidZZ 

RemoveHostZZ 
(ZZ 
stringZZ %
webSiteNameZZ& 1
)ZZ1 2
{[[ 	
var\\ 

iisManager\\ 
=\\ 
new\\  
ServerManager\\! .
(\\. /
)\\/ 0
;\\0 1
var]] 
sites]] 
=]] 

iisManager]] "
.]]" #
Sites]]# (
;]]( )
var__ 
st__ 
=__ 
sites__ 
[__ 
webSiteName__ &
]__& '
;__' (
if`` 
(`` 
st`` 
!=`` 
null`` 
)`` 

iisManager`` &
.``& '
Sites``' ,
.``, -
Remove``- 3
(``3 4
st``4 6
)``6 7
;``7 8
varbb 
poolbb 
=bb 

iisManagerbb !
.bb! "
ApplicationPoolsbb" 2
[bb2 3
webSiteNamebb3 >
]bb> ?
;bb? @
ifcc 
(cc 
poolcc 
!=cc 
nullcc 
)cc 

iisManagercc (
.cc( )
ApplicationPoolscc) 9
.cc9 :
Removecc: @
(cc@ A
poolccA E
)ccE F
;ccF G

iisManageree 
.ee 
CommitChangesee $
(ee$ %
)ee% &
;ee& '
}ff 	
}gg 
}hh Ü
[D:\GithubSvn\GitHub\TestCommitGithub\AddWebsiteToIIS\AddWebToISS\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str &
)& '
]' (
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str (
)( )
]) *
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[## 
assembly## 	
:##	 

AssemblyVersion## 
(## 
$str## $
)##$ %
]##% &
[$$ 
assembly$$ 	
:$$	 

AssemblyFileVersion$$ 
($$ 
$str$$ (
)$$( )
]$$) *